<!DOCTYPE html>
<html>
  <head>
    <title>Digit Reader</title>
    <style>
      body {
        text-align: center;
        font-family: Arial, sans-serif;
        margin-top: 30px;
      }
      #canvas {
        border: 2px solid black;
        background: white;
        cursor: crosshair;
      }
      button {
        margin: 10px;
        padding: 10px 20px;
        font-size: 16px;
        border-radius: 8px;
        border: none;
        background: #4caf50;
        color: white;
        cursor: pointer;
      }
      button:hover {
        background: #45a049;
      }
      #result {
        font-size: 20px;
        font-weight: bold;
        margin-top: 15px;
      }
    </style>
  </head>
  <body>
    <h2>Draw a digit (0-9)</h2>
    <canvas id="canvas" width="280" height="280"></canvas><br />
    <button onclick="clearCanvas()">Reset</button>
    <p id="result">Prediction:</p>

    <script>
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");

      // Initial setup
      ctx.lineWidth = 20;
      ctx.lineCap = "round";
      ctx.strokeStyle = "black";
      ctx.fillStyle = "white";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      let drawing = false;

      canvas.addEventListener("mousedown", () => (drawing = true));
      canvas.addEventListener("mouseup", () => {
        drawing = false;
        ctx.beginPath();
      });
      canvas.addEventListener("mousemove", draw);

      function draw(e) {
        if (!drawing) return;
        ctx.lineTo(e.offsetX, e.offsetY);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(e.offsetX, e.offsetY);
        predict(); // ðŸ”¥ predict while drawing
      }

      function clearCanvas() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "white";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.beginPath();
        document.getElementById("result").innerText = "Prediction: ";
      }

      async function predict() {
        const imgData = canvas.toDataURL("image/png");
        const res = await fetch("/predict", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Cache-Control": "no-cache",
          },
          body: JSON.stringify({ image: imgData }),
        });
        const data = await res.json();
        document.getElementById("result").innerText =
          "Prediction: " + data.prediction;
      }
    </script>
  </body>
</html>
